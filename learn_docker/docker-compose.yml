# 指定 docker-compose 文件的版本
# 不同版本支持的功能和语法会有所不同
version: '3.8'

# 定义服务
# 一个服务代表一个容器，服务之间可以相互访问
services:
  # 定义名为 app 的服务
  # 这个名称会用作容器名的前缀，也用作服务间通信的主机名
  app:
    # 指定构建配置
    # . 表示使用当前目录的 Dockerfile
    build: .
    
    # 端口映射
    # 格式为 "宿主机端口:容器端口"
    # 这里将容器的 8080 端口映射到宿主机的 8080 端口
    ports:
      - "8080:8080"
    
    # 环境变量设置
    # 这些环境变量会被注入到容器中
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    
    # 容器重启策略
    # unless-stopped：除非手动停止，否则总是重启容器
    # 包括 Docker 守护进程重启时也会重启容器
    restart: unless-stopped 