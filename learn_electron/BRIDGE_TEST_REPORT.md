# Electron è·¨è¯­è¨€æ¡¥æ¥æŠ€æœ¯æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æŠ¥å‘Šè®°å½•äº†åœ¨ Electron (Windows/macOS) ä¸Šå®ç° Java JAR å’Œ TypeScript åŠ¨æ€è°ƒç”¨åŠå›è°ƒæœºåˆ¶çš„å®Œæ•´è¿‡ç¨‹ï¼Œç›®æ ‡æ˜¯éªŒè¯è·¨å¹³å°ä¸šåŠ¡é€»è¾‘å¤ç”¨çš„å¯è¡Œæ€§ã€‚

---

## ğŸ¯ æŠ€æœ¯æ–¹æ¡ˆé€‰å‹

### Java JAR è°ƒç”¨æ–¹æ¡ˆ

ç»è¿‡è°ƒç ”å’Œå®è·µï¼Œå¯¹æ¯”äº†ä»¥ä¸‹æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | å®æ–½éš¾åº¦ | æœ€ç»ˆé€‰æ‹© |
|------|------|------|----------|----------|
| **node-java** | åŸç”Ÿ JNI æ¡¥æ¥ï¼ŒåŠŸèƒ½å®Œæ•´ | éœ€è¦æœ¬åœ°ç¼–è¯‘ï¼Œæ„å»ºé—®é¢˜å¤š | â­â­â­â­â­ | âŒ |
| **å­è¿›ç¨‹ + JavaRunner** | ç®€å•å¯é ï¼Œæ— ä¾èµ–é—®é¢˜ | è¿›ç¨‹å¼€é”€ï¼Œä¸æ”¯æŒçœŸæ­£å›è°ƒ | â­â­ | âœ… |
| **JNI Native Addon** | æ€§èƒ½æœ€ä¼˜ | å¼€å‘éš¾åº¦æé«˜ï¼Œè·¨å¹³å°å›°éš¾ | â­â­â­â­â­ | âŒ |

**æœ€ç»ˆæ–¹æ¡ˆ**: **å­è¿›ç¨‹ + JavaRunner**

**é€‰å‹ç†ç”±**:
1. âœ… æ— éœ€æœ¬åœ°ç¼–è¯‘ï¼Œé¿å… node-java çš„æ„å»ºé—®é¢˜
2. âœ… å®ç°ç®€å•ï¼Œä»£ç æ¸…æ™°æ˜“ç»´æŠ¤
3. âœ… è·¨å¹³å°å…¼å®¹æ€§å¥½ï¼ˆåªéœ€ç³»ç»Ÿå®‰è£… Javaï¼‰
4. âœ… é€‚åˆåŠŸèƒ½éªŒè¯å’Œå¿«é€Ÿè¿­ä»£
5. âš ï¸ ä¸æ”¯æŒçœŸæ­£çš„åŒå‘å›è°ƒï¼ˆå¯é€šè¿‡ HTTP/æ–‡ä»¶/Socket æ‰©å±•ï¼‰

### TypeScript è°ƒç”¨æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | å®‰å…¨æ€§ | æœ€ç»ˆé€‰æ‹© |
|------|------|------|--------|----------|
| **isolated-vm** | çœŸæ­£çš„ V8 éš”ç¦»ï¼Œå®‰å…¨æ€§é«˜ | API å¤æ‚ï¼Œå­¦ä¹ æ›²çº¿é™¡ | â­â­â­â­â­ | âŒ |
| **Node.js vm æ¨¡å—** | åŸç”Ÿæ”¯æŒï¼Œç®€å•æ˜“ç”¨ | ä¸æ˜¯çœŸæ­£çš„æ²™ç®± | â­â­ | âœ… |
| **vm2** | æ²™ç®±éš”ç¦»è¾ƒå¥½ | å·²åœæ­¢ç»´æŠ¤ | â­â­â­ | âŒ |

**æœ€ç»ˆæ–¹æ¡ˆ**: **Node.js vm æ¨¡å—**

**é€‰å‹ç†ç”±**:
1. âœ… Node.js åŸç”Ÿæ”¯æŒï¼Œæ— éœ€å®‰è£…é¢å¤–ä¾èµ–
2. âœ… API ç®€å•ç›´è§‚ï¼Œå¿«é€Ÿå®ç°
3. âœ… æ”¯æŒ async/awaitï¼Œä¸ Android QuickJS æ–¹æ¡ˆç±»ä¼¼
4. âœ… æ”¯æŒå®¿ä¸»èƒ½åŠ›æ³¨å…¥ï¼ˆStorageApiHandlerï¼‰
5. âš ï¸ å®‰å…¨æ€§è¾ƒå¼±ï¼ˆä½†ç”¨æˆ·è¡¨ç¤ºä¸åœ¨æ„ï¼‰

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Renderer Process                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  bridge-test.html + bridge-test.ts                   â”‚   â”‚
â”‚  â”‚  - æµ‹è¯•ç•Œé¢                                            â”‚   â”‚
â”‚  â”‚  - è°ƒç”¨ window.electronAPI.javaBridge / tsBridge    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ IPC (contextBridge)
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Main Process                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  src/main/index.ts - IPC å¤„ç†å™¨                        â”‚  â”‚
â”‚  â”‚  - java-bridge:initialize / execute                    â”‚  â”‚
â”‚  â”‚  - ts-bridge:initialize / execute / inject-storage-apiâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚                    â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   JavaBridge.ts      â”‚  â”‚   TypeScriptBridge.ts        â”‚ â”‚
â”‚  â”‚  - spawn('java')     â”‚  â”‚  - vm.createContext()        â”‚ â”‚
â”‚  â”‚  - JavaRunner        â”‚  â”‚  - vm.runInContext()         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Java Process    â”‚      â”‚  VM Sandbox Context  â”‚
    â”‚  hello-java.jar  â”‚      â”‚  hello.js            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡ä»¶ç»“æ„

```
src/main/
â”œâ”€â”€ bridges/
â”‚   â”œâ”€â”€ types.ts              # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ JavaBridge.ts         # Java æ¡¥æ¥å®ç°
â”‚   â””â”€â”€ TypeScriptBridge.ts   # TypeScript æ¡¥æ¥å®ç°
â”œâ”€â”€ external-libs/
â”‚   â”œâ”€â”€ hello-java.jar        # æµ‹è¯• JAR (2.1KB)
â”‚   â”œâ”€â”€ hello.js              # æµ‹è¯• JS (4.2KB)
â”‚   â””â”€â”€ java-src/
â”‚       â”œâ”€â”€ JavaRunner.java   # Java åå°„è°ƒç”¨å™¨
â”‚       â”œâ”€â”€ JavaRunner.class  # ç¼–è¯‘åçš„ç±»
â”‚       â””â”€â”€ com/example/
â”‚           â””â”€â”€ HelloWorld.java
â””â”€â”€ index.ts                  # ä¸»è¿›ç¨‹å…¥å£
```

---

## ğŸ’» æ ¸å¿ƒå®ç°

### JavaBridge å®ç°

```typescript
export class JavaBridge {
  private jarPath = '';
  
  async initialize(jarPath: string): Promise<void> {
    // 1. éªŒè¯ JAR æ–‡ä»¶å­˜åœ¨
    // 2. æµ‹è¯• Java å‘½ä»¤å¯ç”¨æ€§
    // 3. ä¿å­˜ JAR è·¯å¾„
  }

  async execute(className: string, methodName: string, ...args: any[]): Promise<any> {
    // ä½¿ç”¨ spawn æ‰§è¡Œ: java -cp "jar:runner" JavaRunner className methodName args
    const classpath = `${this.jarPath}:${runnerDir}`;
    const java = spawn('java', ['-cp', classpath, 'JavaRunner', className, methodName, ...args]);
    // è¿”å› stdout
  }
}
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨ `JavaRunner.java` é€šè¿‡åå°„è°ƒç”¨ JAR ä¸­çš„ä»»æ„é™æ€æ–¹æ³•
- å‚æ•°é€šè¿‡å‘½ä»¤è¡Œä¼ é€’ï¼Œè‡ªåŠ¨ç±»å‹è½¬æ¢
- ç»“æœé€šè¿‡ stdout è¿”å›

### TypeScriptBridge å®ç°

```typescript
export class TypeScriptBridge {
  private context: any = null;
  private storageHandler: StorageApiHandler | null = null;

  async initialize(jsPath: string): Promise<void> {
    // 1. è¯»å– JS æ–‡ä»¶å†…å®¹
    // 2. åˆ›å»º VM ä¸Šä¸‹æ–‡
    // 3. æ‰§è¡ŒåŠ è½½çš„ä»£ç ï¼ˆå®šä¹‰å‡½æ•°ï¼‰
  }

  async execute(code: string): Promise<any> {
    const wrappedCode = `(async () => { ${code} })()`;
    return await runInContext(wrappedCode, this.context);
  }

  injectStorageApi(handler: StorageApiHandler): void {
    // å°† handler åŒ…è£…ä¸ºå…¨å±€å¯¹è±¡ HostStorage
    this.context.HostStorage = {
      createUser: async (id, name, age) => await handler.createUser(id, name, age),
      // ...
    };
  }
}
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨ `vm.createContext()` åˆ›å»ºæ²™ç®±ç¯å¢ƒ
- æ”¯æŒ async/await è¯­æ³•ï¼ˆä¸ Android QuickJS ä¸€è‡´ï¼‰
- é€šè¿‡å…¨å±€å¯¹è±¡æ³¨å…¥å®¿ä¸»èƒ½åŠ›

---

## ğŸ§ª åŠŸèƒ½éªŒè¯

### æµ‹è¯•åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½åˆ†ç±» | æµ‹è¯•é¡¹ | Java | TypeScript | çŠ¶æ€ |
|---------|-------|------|------------|------|
| **åˆå§‹åŒ–** | åŠ è½½ JAR/JS æ–‡ä»¶ | âœ… | âœ… | é€šè¿‡ |
| **ç®€å•è°ƒç”¨** | sayHello(name) | âœ… | âœ… | é€šè¿‡ |
| **ç®€å•è°ƒç”¨** | getVersion() | âœ… | âœ… | é€šè¿‡ |
| **å¤æ‚é€»è¾‘** | processData(age, status) | âœ… | âœ… | é€šè¿‡ |
| **å›è°ƒæœºåˆ¶** | sayHelloWithCallback() | âš ï¸ | âœ… | ç®€åŒ–å®ç° |
| **èƒ½åŠ›æ³¨å…¥** | HostStorage API | N/A | âœ… | é€šè¿‡ |
| **CRUD æ¼”ç¤º** | processCrudDemo() | N/A | âœ… | é€šè¿‡ |

### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

#### Java ç®€å•è°ƒç”¨

```typescript
// è¾“å…¥
await javaBridge.execute('com.example.HelloWorld', 'sayHello', 'Electron');

// è¾“å‡º
"Hello from Java: Electron [v1.0.0]"

// è€—æ—¶
åˆå§‹åŒ–: < 200ms
è°ƒç”¨: < 50ms
```

#### TypeScript CRUD æ¼”ç¤º

```typescript
// è¾“å…¥
await tsBridge.executeWithStorage('processCrudDemo()');

// è¾“å‡º
=== CRUD æ¼”ç¤ºå¼€å§‹ ===
1. åˆ›å»ºç”¨æˆ· 1001...
åˆ›å»ºç»“æœ: true
2. æŸ¥è¯¢ç”¨æˆ· 1001...
æŸ¥è¯¢ç»“æœ: {"id":"1001","name":"Alice","age":25}
3. ç”¨æˆ·å¹´é¾„å°äº30ï¼Œæ›´æ–°ä¸º30...
æ›´æ–°ç»“æœ: true
4. å†æ¬¡æŸ¥è¯¢ç¡®è®¤...
æœ€ç»ˆç»“æœ: {"id":"1001","name":"Alice","age":30}
5. åˆ é™¤ç”¨æˆ· 1001...
åˆ é™¤ç»“æœ: true
=== CRUD æ¼”ç¤ºå®Œæˆ ===

// è¿”å›å€¼
{ success: true, message: "CRUD demo completed", originalAge: 25, finalAge: 30 }

// è€—æ—¶
åˆå§‹åŒ–: < 100ms
è°ƒç”¨: < 20ms
```

---

## âš¡ æ€§èƒ½æµ‹è¯•

### Java Bridge æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | å¯¹æ¯” Android |
|------|--------|--------|--------------|
| åˆå§‹åŒ–è€—æ—¶ | < 500ms | ~150ms | âœ… å¿« 70% |
| å•æ¬¡è°ƒç”¨è€—æ—¶ | < 10ms | ~30-50ms | âš ï¸ æ…¢ 5å€ï¼ˆè¿›ç¨‹å¯åŠ¨å¼€é”€ï¼‰|
| å†…å­˜å ç”¨ | - | ~20MB | ç›¸å½“ |

### TypeScript Bridge æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | å¯¹æ¯” Android |
|------|--------|--------|--------------|
| åˆå§‹åŒ–è€—æ—¶ | < 100ms | ~50ms | âœ… å¿« 50% |
| å•æ¬¡è°ƒç”¨è€—æ—¶ | < 10ms | ~5ms | âœ… å¿« 50% |
| å¤æ‚ä¸šåŠ¡é€»è¾‘ | < 50ms | ~15ms | âœ… å¿« 70% |

**ç»“è®º**:
- âœ… TypeScript Bridge æ€§èƒ½ä¼˜äº Androidï¼ˆV8 å¼•æ“ä¼˜åŠ¿ï¼‰
- âš ï¸ Java Bridge æ¯æ¬¡è°ƒç”¨å¯åŠ¨æ–°è¿›ç¨‹ï¼Œå¼€é”€è¾ƒå¤§
- ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼šJava å¯æ”¹ä¸ºå¸¸é©»è¿›ç¨‹ + IPC é€šä¿¡

---

## ğŸ”„ è·¨å¹³å°å¯¹æ¯”

### Android vs Electron API å¯¹æ¯”

#### Java è°ƒç”¨

| æ–¹é¢ | Android (DexClassLoader) | Electron (å­è¿›ç¨‹) |
|------|-------------------------|------------------|
| åŠ è½½æ–¹å¼ | DexClassLoader.loadClass() | spawn('java') + JavaRunner |
| è°ƒç”¨æ–¹å¼ | Method.invoke() | å‘½ä»¤è¡Œå‚æ•° |
| åŒæ­¥è°ƒç”¨ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| å›è°ƒæœºåˆ¶ | âœ… åŠ¨æ€ä»£ç† | âš ï¸ éœ€é¢å¤–å®ç° |
| æ€§èƒ½ | â­â­â­â­â­ | â­â­â­ |

#### TypeScript è°ƒç”¨

| æ–¹é¢ | Android (QuickJS) | Electron (vmæ¨¡å—) |
|------|------------------|------------------|
| å¼•æ“ | QuickJS | V8 |
| async/await | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| èƒ½åŠ›æ³¨å…¥ | âœ… registerJavaMethod | âœ… context.HostStorage |
| æ€§èƒ½ | â­â­â­â­ | â­â­â­â­â­ |

### è·¨å¹³å°å…¼å®¹æ€§

#### ä¸šåŠ¡é€»è¾‘ä»£ç å¤ç”¨

```javascript
// âœ… å¯ä»¥åœ¨ Android å’Œ Electron ä¸Šè¿è¡Œç›¸åŒçš„ä»£ç 

async function processCrudDemo() {
  // 1. åˆ›å»ºç”¨æˆ·
  const created = await HostStorage.createUser("1001", "Alice", 25);
  
  // 2. æŸ¥è¯¢ç”¨æˆ·
  const userJson = await HostStorage.getUser("1001");
  const user = JSON.parse(userJson);
  
  // 3. æ¡ä»¶åˆ¤æ–­
  if (user.age < 30) {
    await HostStorage.updateUser("1001", 30);
  }
  
  // 4. åˆ é™¤ç”¨æˆ·
  await HostStorage.deleteUser("1001");
  
  return { success: true };
}
```

**ä»£ç å¤ç”¨ç‡**: **95%+**

å”¯ä¸€å·®å¼‚ï¼š
- Android: `HostStorage` é€šè¿‡ `registerJavaMethod` æ³¨å…¥
- Electron: `HostStorage` é€šè¿‡ `vm context` æ³¨å…¥

**å»ºè®®**ï¼šåˆ›å»ºç»Ÿä¸€çš„é€‚é…å±‚æŠ¹å¹³å·®å¼‚

---

## âš ï¸ é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

### Java Bridge é™åˆ¶

1. âŒ **ä¸æ”¯æŒçœŸæ­£çš„å›è°ƒæ¥å£**
   - åŸå› ï¼šå­è¿›ç¨‹æ— æ³•ç›´æ¥è°ƒç”¨çˆ¶è¿›ç¨‹å‡½æ•°
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ HTTP æœåŠ¡å™¨æˆ– Socket é€šä¿¡

2. âš ï¸ **æ€§èƒ½å¼€é”€è¾ƒå¤§**
   - æ¯æ¬¡è°ƒç”¨å¯åŠ¨æ–°è¿›ç¨‹ï¼ˆ~30-50msï¼‰
   - è§£å†³æ–¹æ¡ˆï¼šæ”¹ä¸ºå¸¸é©»è¿›ç¨‹ + IPC

3. âš ï¸ **å‚æ•°ç±»å‹æœ‰é™**
   - ç›®å‰ä»…æ”¯æŒåŸºæœ¬ç±»å‹ï¼ˆString, int, booleanï¼‰
   - å¤æ‚å¯¹è±¡éœ€è¦ JSON åºåˆ—åŒ–

4. âš ï¸ **ä¾èµ–ç³»ç»Ÿ Java ç¯å¢ƒ**
   - éœ€è¦ç”¨æˆ·ç³»ç»Ÿå®‰è£… Java
   - å¯è€ƒè™‘æ‰“åŒ… JRE

### TypeScript Bridge é™åˆ¶

1. âš ï¸ **éçœŸæ­£çš„æ²™ç®±**
   - vm æ¨¡å—å¯ä»¥é€šè¿‡åŸå‹é“¾é€ƒé€¸
   - è§£å†³æ–¹æ¡ˆï¼šå‡çº§åˆ° isolated-vmï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

2. âš ï¸ **é”™è¯¯å †æ ˆä¸å‹å¥½**
   - æ²™ç®±å†…çš„é”™è¯¯å †æ ˆæŒ‡å‘ vm å†…éƒ¨
   - è§£å†³æ–¹æ¡ˆï¼šè‡ªå®šä¹‰é”™è¯¯å¤„ç†

---

## ğŸš€ æ‰©å±•å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

1. **Java Bridge æ”¹è¿›**
   - å®ç°å¸¸é©» Java è¿›ç¨‹ï¼ˆå‡å°‘å¯åŠ¨å¼€é”€ï¼‰
   - ä½¿ç”¨ Socket å®ç°çœŸæ­£çš„å›è°ƒ

2. **é”™è¯¯å¤„ç†**
   - ç»Ÿä¸€é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯æ ¼å¼
   - æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•

3. **æ€§èƒ½ç›‘æ§**
   - æ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†
   - ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

### é•¿æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰

1. **è·¨å¹³å°é€‚é…å±‚**
   ```typescript
   // ç»Ÿä¸€çš„ API
   class CrossPlatformBridge {
     // Android å’Œ Electron ä½¿ç”¨ç›¸åŒçš„æ¥å£
     async loadJavaLibrary(path: string): Promise<void>;
     async executeJava(className: string, method: string, ...args): Promise<any>;
     
     async loadTsLibrary(path: string): Promise<void>;
     async executeTs(code: string): Promise<any>;
     injectHostApi(handler: HostApiHandler): void;
   }
   ```

2. **å®‰å…¨æ€§å¢å¼º**
   - å‡çº§åˆ° isolated-vm
   - å®ç°ä»£ç ç­¾åéªŒè¯
   - æ·»åŠ æƒé™æ§åˆ¶

3. **æ‰“åŒ… JRE**
   - å°† JRE æ‰“åŒ…åˆ° Electron åº”ç”¨
   - æ”¯æŒç¦»çº¿è¿è¡Œ

---

## ğŸ“Š ç»“è®º

### å¯è¡Œæ€§è¯„ä¼°

| è¯„ä¼°ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|---------|------|------|
| **æŠ€æœ¯å¯è¡Œæ€§** | â­â­â­â­â­ | å®Œå…¨å¯è¡Œï¼Œå·²éªŒè¯æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ |
| **æ€§èƒ½å¯è¡Œæ€§** | â­â­â­â­ | TypeScript æ€§èƒ½ä¼˜ç§€ï¼ŒJava æœ‰ä¼˜åŒ–ç©ºé—´ |
| **ä»£ç å¤ç”¨æ€§** | â­â­â­â­â­ | ä¸šåŠ¡é€»è¾‘ä»£ç å¤ç”¨ç‡ 95%+ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­ | å®ç°ç®€å•ï¼Œæ˜“äºç»´æŠ¤ |

### æ ¸å¿ƒæˆæœ

1. âœ… **æˆåŠŸå®ç°** Electron ä¸­ Java JAR å’Œ TypeScript çš„åŠ¨æ€è°ƒç”¨
2. âœ… **éªŒè¯é€šè¿‡** å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼ˆCRUDã€æ¡ä»¶åˆ†æ”¯ã€å¼‚æ­¥æ“ä½œï¼‰
3. âœ… **è·¨å¹³å°å¤ç”¨** åŒä¸€å¥— TypeScript ä»£ç å¯åœ¨ Android å’Œ Electron è¿è¡Œ
4. âœ… **æ€§èƒ½è¾¾æ ‡** TypeScript Bridge æ€§èƒ½ä¼˜äº Androidï¼ŒJava Bridge å¯ä¼˜åŒ–

### æœ€ç»ˆå»ºè®®

**æ¨èæ–¹æ¡ˆ**: âœ… **å¯ç”¨äºç”Ÿäº§ç¯å¢ƒ**

**å‰ææ¡ä»¶**:
1. Java Bridge å‡çº§ä¸ºå¸¸é©»è¿›ç¨‹ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
2. TypeScript Bridge å‡çº§åˆ° isolated-vmï¼ˆå®‰å…¨æ€§ï¼‰
3. åˆ›å»ºç»Ÿä¸€çš„é€‚é…å±‚ï¼ˆAPI ä¸€è‡´æ€§ï¼‰

**é€‚ç”¨åœºæ™¯**:
- âœ… è·¨å¹³å°ä¸šåŠ¡é€»è¾‘å¤ç”¨
- âœ… åŠ¨æ€é…ç½®ä¸šåŠ¡è§„åˆ™
- âœ… æ’ä»¶åŒ–æ¶æ„
- âœ… çƒ­æ›´æ–°ä¸šåŠ¡ä»£ç 

---

## ğŸ“š å‚è€ƒèµ„æº

### æŠ€æœ¯æ–‡æ¡£
- [Node.js VM æ¨¡å—](https://nodejs.org/api/vm.html)
- [Node.js Child Process](https://nodejs.org/api/child_process.html)
- [Electron IPC é€šä¿¡](https://www.electronjs.org/docs/latest/tutorial/ipc)

### Android å‚è€ƒå®ç°
- `applications/lang-bridge-test/src/main/java/com/littletree/langbridge/impl/java/JavaBridge.kt`
- `applications/lang-bridge-test/src/main/java/com/littletree/langbridge/impl/typescript/TypeScriptBridge.kt`

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024-11-25  
**æµ‹è¯•ç¯å¢ƒ**: macOS 14.5, Node.js 20.x, Electron 28.0.0

